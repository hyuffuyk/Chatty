<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 챗봇 (메모리 기능 포함)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f4f4f4;
        }
        #chatbox {
            width: 90%;
            max-width: 400px;
            height: 500px;
            border: 1px solid #ccc;
            border-radius: 10px;
            overflow-y: auto;
            padding: 10px;
            background-color: white;
        }
        .message {
            padding: 8px;
            margin: 5px;
            border-radius: 10px;
            max-width: 70%;
        }
        .user {
            background-color: #007bff;
            color: white;
            align-self: flex-end;
            text-align: right;
        }
        .bot {
            background-color: #e0e0e0;
            align-self: flex-start;
        }
        #inputArea {
            display: flex;
            width: 90%;
            max-width: 400px;
            margin-top: 10px;
        }
        #userInput {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        #sendBtn {
            padding: 8px 15px;
            margin-left: 5px;
            border: none;
            background-color: #007bff;
            color: white;
            cursor: pointer;
            border-radius: 5px;
        }
        #sendBtn:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>

    <div id="chatbox"></div>

    <div id="inputArea">
        <input type="text" id="userInput" placeholder="메시지를 입력하세요...">
        <button id="sendBtn">전송</button>
    </div>

    <script>
        let userName = localStorage.getItem("userName") || "";
        let chatHistory = JSON.parse(localStorage.getItem("chatHistory")) || [];

        document.getElementById("sendBtn").addEventListener("click", sendMessage);
        document.getElementById("userInput").addEventListener("keypress", function(event) {
            if (event.key === "Enter") sendMessage();
        });

        function loadChatHistory() {
            let chatbox = document.getElementById("chatbox");
            chatbox.innerHTML = "";  // 기존 대화 초기화
            chatHistory.forEach(msg => {
                appendMessage(msg.text, msg.sender);
            });

            if (chatHistory.length === 0) {
                appendMessage("안녕하세요! 이름이 무엇인가요?", "bot");
            }
        }

        function sendMessage() {
            let userText = document.getElementById("userInput").value.trim();
            if (userText === "") return;

            appendMessage(userText, "user");
            chatHistory.push({ text: userText, sender: "user" });

            setTimeout(() => {
                let botReply = getBotResponse(userText.toLowerCase());
                appendMessage(botReply, "bot");
                chatHistory.push({ text: botReply, sender: "bot" });

                localStorage.setItem("chatHistory", JSON.stringify(chatHistory));
            }, 500);

            document.getElementById("userInput").value = "";
        }

        function appendMessage(text, sender) {
            let chatbox = document.getElementById("chatbox");
            let msgDiv = document.createElement("div");
            msgDiv.classList.add("message", sender);
            msgDiv.innerText = text;
            chatbox.appendChild(msgDiv);
            chatbox.scrollTop = chatbox.scrollHeight;
        }

        function getBotResponse(input) {
            if (!userName) {
                userName = input.charAt(0).toUpperCase() + input.slice(1);
                localStorage.setItem("userName", userName);
                return `반가워요, ${userName}! 어떻게 도와드릴까요?`;
            }

            let responses = {
                "안녕": `안녕하세요, ${userName}!`,
                "이름이 뭐야": `저는 웹 챗봇입니다! 당신의 이름은 ${userName}이죠?`,
                "뭐해": "당신과 대화하고 있어요!",
                "날씨 어때": "날씨 정보를 찾을 수 없지만, 창밖을 보면 알 수 있어요!",
                "고마워": "천만에요! 또 질문해주세요.",
                "잘가": "안녕히 가세요! 다음에 또 만나요."
            };

            for (let key in responses) {
                if (input.includes(key)) {
                    return responses[key];
                }
            }
            return `${userName}, 이해하지 못했어요. 다른 질문을 해주세요!`;
        }

        loadChatHistory();
    </script>

</body>
</html>